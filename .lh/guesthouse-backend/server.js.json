{
    "sourceFile": "guesthouse-backend/server.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 9,
            "patches": [
                {
                    "date": 1757140190170,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1757271296763,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,19 +77,23 @@\n     id: existingData.length - 1,\r\n   });\r\n });\r\n \r\n-// âœ… Booking Summary API (Daily / Weekly / Monthly)\r\n+// âœ… Booking Summary API (Daily / Weekly / Monthly) with checkout filter\r\n app.get(\"/api/bookings/summary\", (req, res) => {\r\n   const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n+  const today = new Date(); // à¤†à¤œ à¤•à¥€ date\r\n \r\n   const summary = { daily: {}, weekly: {}, monthly: {} };\r\n \r\n   bookings.forEach((b) => {\r\n     const checkIn = new Date(b.checkIn || b.checkInDate);\r\n     const checkOut = new Date(b.checkOut || b.checkOutDate);\r\n     if (isNaN(checkIn) || isNaN(checkOut)) return;\r\n \r\n+    // âœ… à¤…à¤—à¤° booking à¤•à¤¾ checkout à¤†à¤œ à¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ à¤¹à¥ˆ â†’ skip à¤•à¤° à¤¦à¥‹\r\n+    if (checkOut < today) return;\r\n+\r\n     const rooms = parseInt(b.roomsRequired) || 1;\r\n \r\n     for (let d = new Date(checkIn); d <= checkOut; d.setDate(d.getDate() + 1)) {\r\n       const dayKey = d.toISOString().split(\"T\")[0];\r\n"
                },
                {
                    "date": 1757271906545,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,9 +80,9 @@\n \r\n // âœ… Booking Summary API (Daily / Weekly / Monthly) with checkout filter\r\n app.get(\"/api/bookings/summary\", (req, res) => {\r\n   const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n-  const today = new Date(); // à¤†à¤œ à¤•à¥€ date\r\n+  const today = new Date();\r\n \r\n   const summary = { daily: {}, weekly: {}, monthly: {} };\r\n \r\n   bookings.forEach((b) => {\r\n@@ -114,8 +114,28 @@\n \r\n   res.json(summary);\r\n });\r\n \r\n+// âœ… Admin Dashboard Stats API\r\n+app.get(\"/api/admin/dashboard\", (req, res) => {\r\n+  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n+  const today = new Date();\r\n+\r\n+  const activeBookings = bookings.filter(b => new Date(b.checkOut || b.checkOutDate) >= today);\r\n+\r\n+  const totalBookings = bookings.length;\r\n+  const availableRooms = 20 - activeBookings.reduce((sum, b) => sum + (parseInt(b.roomsRequired) || 1), 0);\r\n+  const onlinePayments = bookings.filter(b => b.paymentStatus?.toLowerCase() === \"online\").length;\r\n+  const cashPayments = bookings.filter(b => b.paymentStatus?.toLowerCase() === \"cash\").length;\r\n+\r\n+  res.json({\r\n+    totalBookings,\r\n+    availableRooms: availableRooms < 0 ? 0 : availableRooms,\r\n+    onlinePayments,\r\n+    cashPayments\r\n+  });\r\n+});\r\n+\r\n // âœ… Invoice API\r\n app.get(\"/api/bookings/:id/invoice\", (req, res) => {\r\n   const id = parseInt(req.params.id);\r\n   const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n"
                },
                {
                    "date": 1757274613260,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,4 @@\n-// âœ… Full server.js with check-in/out date & time and additional guest info in PDF\r\n-\r\n const express = require(\"express\");\r\n const cors = require(\"cors\");\r\n const fs = require(\"fs\");\r\n const path = require(\"path\");\r\n@@ -77,37 +75,55 @@\n     id: existingData.length - 1,\r\n   });\r\n });\r\n \r\n-// âœ… Booking Summary API (Daily / Weekly / Monthly) with checkout filter\r\n+// âœ… Check Room Availability API\r\n+app.get(\"/api/rooms/check-availability/:roomType\", (req, res) => {\r\n+  const { roomType } = req.params;\r\n+\r\n+  // Total rooms available per type\r\n+  const totalRoomsPerType = { Single: 10, Double: 5, Suite: 3 };\r\n+\r\n+  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n+  const today = new Date();\r\n+\r\n+  // Count booked rooms of this type which are active (today <= checkOut)\r\n+  const bookedRooms = bookings.reduce((sum, b) => {\r\n+    const checkOutDate = new Date(`${b.checkOutDate}T${b.checkOutTime || \"00:00\"}`);\r\n+    if (b.roomType === roomType && checkOutDate >= today) {\r\n+      return sum + (parseInt(b.roomsRequired) || 1);\r\n+    }\r\n+    return sum;\r\n+  }, 0);\r\n+\r\n+  const availableRooms = (totalRoomsPerType[roomType] || 0) - bookedRooms;\r\n+  res.json({ available: availableRooms > 0 });\r\n+});\r\n+\r\n+// âœ… Booking Summary API\r\n app.get(\"/api/bookings/summary\", (req, res) => {\r\n   const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n   const today = new Date();\r\n-\r\n   const summary = { daily: {}, weekly: {}, monthly: {} };\r\n \r\n   bookings.forEach((b) => {\r\n-    const checkIn = new Date(b.checkIn || b.checkInDate);\r\n-    const checkOut = new Date(b.checkOut || b.checkOutDate);\r\n+    const checkIn = new Date(b.checkInDate);\r\n+    const checkOut = new Date(b.checkOutDate);\r\n     if (isNaN(checkIn) || isNaN(checkOut)) return;\r\n \r\n-    // âœ… à¤…à¤—à¤° booking à¤•à¤¾ checkout à¤†à¤œ à¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ à¤¹à¥ˆ â†’ skip à¤•à¤° à¤¦à¥‹\r\n     if (checkOut < today) return;\r\n \r\n     const rooms = parseInt(b.roomsRequired) || 1;\r\n \r\n     for (let d = new Date(checkIn); d <= checkOut; d.setDate(d.getDate() + 1)) {\r\n       const dayKey = d.toISOString().split(\"T\")[0];\r\n \r\n-      // Daily\r\n       summary.daily[dayKey] = (summary.daily[dayKey] || 0) + rooms;\r\n \r\n-      // Weekly\r\n       const weekNum = Math.ceil(d.getDate() / 7);\r\n       const weekKey = `${d.getFullYear()}-W${weekNum}`;\r\n       summary.weekly[weekKey] = (summary.weekly[weekKey] || 0) + rooms;\r\n \r\n-      // Monthly\r\n       const monthKey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}`;\r\n       summary.monthly[monthKey] = (summary.monthly[monthKey] || 0) + rooms;\r\n     }\r\n   });\r\n@@ -119,9 +135,9 @@\n app.get(\"/api/admin/dashboard\", (req, res) => {\r\n   const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n   const today = new Date();\r\n \r\n-  const activeBookings = bookings.filter(b => new Date(b.checkOut || b.checkOutDate) >= today);\r\n+  const activeBookings = bookings.filter(b => new Date(b.checkOutDate) >= today);\r\n \r\n   const totalBookings = bookings.length;\r\n   const availableRooms = 20 - activeBookings.reduce((sum, b) => sum + (parseInt(b.roomsRequired) || 1), 0);\r\n   const onlinePayments = bookings.filter(b => b.paymentStatus?.toLowerCase() === \"online\").length;\r\n"
                },
                {
                    "date": 1757870726293,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -75,9 +75,9 @@\n     id: existingData.length - 1,\r\n   });\r\n });\r\n \r\n-// âœ… Check Room Availability API\r\n+// âœ… Check Room Availability API (GET)\r\n app.get(\"/api/rooms/check-availability/:roomType\", (req, res) => {\r\n   const { roomType } = req.params;\r\n \r\n   // Total rooms available per type\r\n@@ -98,8 +98,27 @@\n   const availableRooms = (totalRoomsPerType[roomType] || 0) - bookedRooms;\r\n   res.json({ available: availableRooms > 0 });\r\n });\r\n \r\n+// âœ… Check Room Availability API (POST - for React frontend)\r\n+app.post(\"/api/check-availability\", (req, res) => {\r\n+  const { roomType } = req.body;\r\n+  const totalRoomsPerType = { Single: 10, Double: 5, Suite: 3 };\r\n+  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n+  const today = new Date();\r\n+\r\n+  const bookedRooms = bookings.reduce((sum, b) => {\r\n+    const checkOutDate = new Date(`${b.checkOutDate}T${b.checkOutTime || \"00:00\"}`);\r\n+    if (b.roomType === roomType && checkOutDate >= today) {\r\n+      return sum + (parseInt(b.roomsRequired) || 1);\r\n+    }\r\n+    return sum;\r\n+  }, 0);\r\n+\r\n+  const availableRooms = (totalRoomsPerType[roomType] || 0) - bookedRooms;\r\n+  res.json({ available: availableRooms > 0 });\r\n+});\r\n+\r\n // âœ… Booking Summary API\r\n app.get(\"/api/bookings/summary\", (req, res) => {\r\n   const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n   const today = new Date();\r\n@@ -235,8 +254,9 @@\n \r\n   doc.end();\r\n });\r\n \r\n+// âœ… Serve React frontend\r\n const buildPath = path.join(__dirname, \"../guesthouse-frontend/build\");\r\n app.use(express.static(buildPath));\r\n app.get(/.*/, (req, res) => res.sendFile(path.join(buildPath, \"index.html\")));\r\n \r\n"
                },
                {
                    "date": 1757870846308,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,263 +1,18 @@\n-const express = require(\"express\");\r\n-const cors = require(\"cors\");\r\n-const fs = require(\"fs\");\r\n-const path = require(\"path\");\r\n-const PDFDocument = require(\"pdfkit\");\r\n-\r\n-const app = express();\r\n-const PORT = 5000;\r\n-\r\n-app.use(cors());\r\n-app.use(express.json());\r\n-\r\n-const filePath = path.join(__dirname, \"booking.json\");\r\n-\r\n-// âœ… GET All Bookings\r\n-app.get(\"/api/bookings\", (req, res) => {\r\n-  const data = fs.existsSync(filePath) ? fs.readFileSync(filePath) : \"[]\";\r\n-  res.send(JSON.parse(data));\r\n-});\r\n-\r\n-// âœ… POST New Booking with Validation\r\n-app.post(\"/api/bookings\", (req, res) => {\r\n-  const existingData = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n-  const newBooking = req.body;\r\n-\r\n-  if (\r\n-    !newBooking.fullName ||\r\n-    !newBooking.email ||\r\n-    !newBooking.phone ||\r\n-    !newBooking.roomType ||\r\n-    !newBooking.checkInDate ||\r\n-    !newBooking.checkOutDate\r\n-  ) {\r\n-    return res\r\n-      .status(400)\r\n-      .send({ success: false, message: \"âš ï¸ Please fill all required fields.\" });\r\n-  }\r\n-\r\n-  const rooms = parseInt(newBooking.roomsRequired) || 1;\r\n-  const maxAllowedGuests = rooms * 3;\r\n-  const totalPersons = 1 + (newBooking.guests?.length || 0);\r\n-  if (totalPersons > maxAllowedGuests) {\r\n-    return res.status(400).send({\r\n-      success: false,\r\n-      message: `âš ï¸ Only ${maxAllowedGuests} persons allowed for ${rooms} room(s).`,\r\n+const checkAvailability = async () => {\r\n+  try {\r\n+    const res = await fetch(\"http://localhost:5000/api/rooms/check-availability\", {\r\n+      method: \"POST\",\r\n+      headers: { \"Content-Type\": \"application/json\" },\r\n+      body: JSON.stringify({\r\n+        roomType: \"Single\",\r\n+        checkInDate: \"2025-09-20\",\r\n+        checkOutDate: \"2025-09-22\"\r\n+      }),\r\n     });\r\n-  }\r\n \r\n-  const checkIn = new Date(`${newBooking.checkInDate}T${newBooking.checkInTime}`);\r\n-  const checkOut = new Date(`${newBooking.checkOutDate}T${newBooking.checkOutTime}`);\r\n-  const days = Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24));\r\n-\r\n-  let rate = 0;\r\n-  switch (newBooking.roomType) {\r\n-    case \"Single\":\r\n-      rate = 800;\r\n-      break;\r\n-    case \"Double\":\r\n-      rate = 1200;\r\n-      break;\r\n-    case \"Suite\":\r\n-      rate = 1800;\r\n-      break;\r\n+    const data = await res.json();\r\n+    console.log(data);\r\n+  } catch (err) {\r\n+    console.error(\"Error checking availability\", err);\r\n   }\r\n-\r\n-  newBooking.amount = rate * days * rooms;\r\n-  newBooking.createdAt = new Date().toISOString();\r\n-\r\n-  existingData.push(newBooking);\r\n-  fs.writeFileSync(filePath, JSON.stringify(existingData, null, 2));\r\n-\r\n-  res.send({\r\n-    success: true,\r\n-    message: \"Booking saved successfully\",\r\n-    id: existingData.length - 1,\r\n-  });\r\n-});\r\n-\r\n-// âœ… Check Room Availability API (GET)\r\n-app.get(\"/api/rooms/check-availability/:roomType\", (req, res) => {\r\n-  const { roomType } = req.params;\r\n-\r\n-  // Total rooms available per type\r\n-  const totalRoomsPerType = { Single: 10, Double: 5, Suite: 3 };\r\n-\r\n-  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n-  const today = new Date();\r\n-\r\n-  // Count booked rooms of this type which are active (today <= checkOut)\r\n-  const bookedRooms = bookings.reduce((sum, b) => {\r\n-    const checkOutDate = new Date(`${b.checkOutDate}T${b.checkOutTime || \"00:00\"}`);\r\n-    if (b.roomType === roomType && checkOutDate >= today) {\r\n-      return sum + (parseInt(b.roomsRequired) || 1);\r\n-    }\r\n-    return sum;\r\n-  }, 0);\r\n-\r\n-  const availableRooms = (totalRoomsPerType[roomType] || 0) - bookedRooms;\r\n-  res.json({ available: availableRooms > 0 });\r\n-});\r\n-\r\n-// âœ… Check Room Availability API (POST - for React frontend)\r\n-app.post(\"/api/check-availability\", (req, res) => {\r\n-  const { roomType } = req.body;\r\n-  const totalRoomsPerType = { Single: 10, Double: 5, Suite: 3 };\r\n-  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n-  const today = new Date();\r\n-\r\n-  const bookedRooms = bookings.reduce((sum, b) => {\r\n-    const checkOutDate = new Date(`${b.checkOutDate}T${b.checkOutTime || \"00:00\"}`);\r\n-    if (b.roomType === roomType && checkOutDate >= today) {\r\n-      return sum + (parseInt(b.roomsRequired) || 1);\r\n-    }\r\n-    return sum;\r\n-  }, 0);\r\n-\r\n-  const availableRooms = (totalRoomsPerType[roomType] || 0) - bookedRooms;\r\n-  res.json({ available: availableRooms > 0 });\r\n-});\r\n-\r\n-// âœ… Booking Summary API\r\n-app.get(\"/api/bookings/summary\", (req, res) => {\r\n-  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n-  const today = new Date();\r\n-  const summary = { daily: {}, weekly: {}, monthly: {} };\r\n-\r\n-  bookings.forEach((b) => {\r\n-    const checkIn = new Date(b.checkInDate);\r\n-    const checkOut = new Date(b.checkOutDate);\r\n-    if (isNaN(checkIn) || isNaN(checkOut)) return;\r\n-\r\n-    if (checkOut < today) return;\r\n-\r\n-    const rooms = parseInt(b.roomsRequired) || 1;\r\n-\r\n-    for (let d = new Date(checkIn); d <= checkOut; d.setDate(d.getDate() + 1)) {\r\n-      const dayKey = d.toISOString().split(\"T\")[0];\r\n-\r\n-      summary.daily[dayKey] = (summary.daily[dayKey] || 0) + rooms;\r\n-\r\n-      const weekNum = Math.ceil(d.getDate() / 7);\r\n-      const weekKey = `${d.getFullYear()}-W${weekNum}`;\r\n-      summary.weekly[weekKey] = (summary.weekly[weekKey] || 0) + rooms;\r\n-\r\n-      const monthKey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}`;\r\n-      summary.monthly[monthKey] = (summary.monthly[monthKey] || 0) + rooms;\r\n-    }\r\n-  });\r\n-\r\n-  res.json(summary);\r\n-});\r\n-\r\n-// âœ… Admin Dashboard Stats API\r\n-app.get(\"/api/admin/dashboard\", (req, res) => {\r\n-  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n-  const today = new Date();\r\n-\r\n-  const activeBookings = bookings.filter(b => new Date(b.checkOutDate) >= today);\r\n-\r\n-  const totalBookings = bookings.length;\r\n-  const availableRooms = 20 - activeBookings.reduce((sum, b) => sum + (parseInt(b.roomsRequired) || 1), 0);\r\n-  const onlinePayments = bookings.filter(b => b.paymentStatus?.toLowerCase() === \"online\").length;\r\n-  const cashPayments = bookings.filter(b => b.paymentStatus?.toLowerCase() === \"cash\").length;\r\n-\r\n-  res.json({\r\n-    totalBookings,\r\n-    availableRooms: availableRooms < 0 ? 0 : availableRooms,\r\n-    onlinePayments,\r\n-    cashPayments\r\n-  });\r\n-});\r\n-\r\n-// âœ… Invoice API\r\n-app.get(\"/api/bookings/:id/invoice\", (req, res) => {\r\n-  const id = parseInt(req.params.id);\r\n-  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n-  const booking = bookings[id];\r\n-  if (!booking) return res.status(404).send({ error: \"Booking not found\" });\r\n-\r\n-  const doc = new PDFDocument({ margin: 50 });\r\n-  res.setHeader(\"Content-Type\", \"application/pdf\");\r\n-  res.setHeader(\"Content-Disposition\", `attachment; filename=invoice-${id}.pdf`);\r\n-  doc.pipe(res);\r\n-\r\n-  const logoPath = path.join(__dirname, \"university-logo.png\");\r\n-  doc.save().rect(20, 20, 572, 752).lineWidth(2).strokeColor(\"#003366\").stroke().restore();\r\n-  if (fs.existsSync(logoPath)) doc.opacity(0.08).image(logoPath, 180, 340, { width: 250 }).opacity(1);\r\n-  doc.save().rect(20, 20, 572, 90).fill(\"#003366\").restore();\r\n-  if (fs.existsSync(logoPath)) doc.image(logoPath, 40, 30, { width: 70 });\r\n-  doc.fillColor(\"white\").fontSize(24).text(\"Aryabhatta Knowledge University\", 130, 40);\r\n-  doc.fontSize(14).text(\"Guest House Booking Invoice\", 130, 65);\r\n-  doc.fillColor(\"#003366\").moveTo(40, 130).lineTo(560, 130).stroke();\r\n-\r\n-  const left = 40;\r\n-  const columnWidth = 200;\r\n-  let y = 150;\r\n-\r\n-  const details = [\r\n-    [\"Guest Name\", booking.fullName],\r\n-    [\"Address\", booking.address],\r\n-    [\"Email\", booking.email],\r\n-    [\"Phone\", booking.phone],\r\n-    [\"Purpose of Visit\", booking.purpose],\r\n-    [\"Room Type\", booking.roomType],\r\n-    [\"Rooms Required\", booking.roomsRequired],\r\n-    [\"Check-In\", `${booking.checkInDate} ${booking.checkInTime}`],\r\n-    [\"Check-Out\", `${booking.checkOutDate} ${booking.checkOutTime}`],\r\n-    [\"Category\", booking.category],\r\n-    [\"Payment Status\", booking.paymentStatus],\r\n-    [\"Amount Paid\", `INR ${booking.amount}`],\r\n-    [\"Booking Date\", new Date(booking.createdAt).toLocaleString()],\r\n-  ];\r\n-\r\n-  details.forEach(([label, value], i) => {\r\n-    const bg = i % 2 === 0 ? \"#f0f4f8\" : \"#ffffff\";\r\n-    doc.save().rect(left, y - 2, 500, 25).fill(bg).restore();\r\n-    doc.fillColor(\"#003366\").font(\"Helvetica-Bold\").fontSize(12).text(label, left + 10, y + 5);\r\n-    doc.fillColor(\"black\").font(\"Helvetica\").text(value || \"-\", left + columnWidth + 20, y + 5);\r\n-    y += 25;\r\n-  });\r\n-\r\n-  if (booking.guests && booking.guests.length > 0) {\r\n-    y += 30;\r\n-    doc.fontSize(14).fillColor(\"#003366\").text(\"Additional Guests\", left, y);\r\n-    y += 20;\r\n-    doc.fontSize(11).fillColor(\"white\").save().rect(left, y - 2, 500, 20).fill(\"#003366\").restore();\r\n-    doc.fillColor(\"white\").font(\"Helvetica-Bold\")\r\n-      .text(\"Name\", left + 5, y + 3)\r\n-      .text(\"Email\", left + 120, y + 3)\r\n-      .text(\"Phone\", left + 260, y + 3)\r\n-      .text(\"Age\", left + 380, y + 3);\r\n-    y += 22;\r\n-\r\n-    booking.guests.forEach((g, i) => {\r\n-      const bg = i % 2 === 0 ? \"#f9f9f9\" : \"#ffffff\";\r\n-      doc.save().rect(left, y - 2, 500, 20).fill(bg).restore();\r\n-      doc.fillColor(\"black\").font(\"Helvetica\").fontSize(10)\r\n-        .text(g.name || \"\", left + 5, y + 3)\r\n-        .text(g.email || \"\", left + 120, y + 3)\r\n-        .text(g.phone || \"\", left + 260, y + 3)\r\n-        .text(g.age || \"\", left + 380, y + 3);\r\n-      y += 22;\r\n-    });\r\n-  }\r\n-\r\n-  const signY = y + 40;\r\n-  doc.fontSize(12).fillColor(\"black\").text(\"Authorized Signature:\", left, signY);\r\n-  doc.moveTo(left + 150, signY + 15).lineTo(left + 280, signY + 15).strokeColor(\"#333\").stroke();\r\n-\r\n-  doc.moveTo(40, signY + 60).lineTo(560, signY + 60).strokeColor(\"#999\").stroke();\r\n-  doc.fontSize(12).fillColor(\"#003366\").text(\"Thank you for booking with Aryabhatta Knowledge University!\", 40, signY + 70, { align: \"center\" });\r\n-  doc.fontSize(10).fillColor(\"black\").text(\"ðŸ“ Address: Aryabhatta Knowledge University, Patna, Bihar\", 40, signY + 90, { align: \"center\" });\r\n-  doc.text(\"â˜Žï¸ Contact: +91 9525594357   |   âœ‰ï¸ Email: info@aku.ac.in\", 40, signY + 105, { align: \"center\" });\r\n-\r\n-  doc.end();\r\n-});\r\n-\r\n-// âœ… Serve React frontend\r\n-const buildPath = path.join(__dirname, \"../guesthouse-frontend/build\");\r\n-app.use(express.static(buildPath));\r\n-app.get(/.*/, (req, res) => res.sendFile(path.join(buildPath, \"index.html\")));\r\n-\r\n-app.listen(PORT, () => console.log(`ðŸš€ Server running at http://localhost:${PORT}`));\r\n+};\r\n"
                },
                {
                    "date": 1757870909791,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,18 +1,263 @@\n-const checkAvailability = async () => {\r\n-  try {\r\n-    const res = await fetch(\"http://localhost:5000/api/rooms/check-availability\", {\r\n-      method: \"POST\",\r\n-      headers: { \"Content-Type\": \"application/json\" },\r\n-      body: JSON.stringify({\r\n-        roomType: \"Single\",\r\n-        checkInDate: \"2025-09-20\",\r\n-        checkOutDate: \"2025-09-22\"\r\n-      }),\r\n+const express = require(\"express\");\r\n+const cors = require(\"cors\");\r\n+const fs = require(\"fs\");\r\n+const path = require(\"path\");\r\n+const PDFDocument = require(\"pdfkit\");\r\n+\r\n+const app = express();\r\n+const PORT = 5000;\r\n+\r\n+app.use(cors());\r\n+app.use(express.json());\r\n+\r\n+const filePath = path.join(__dirname, \"booking.json\");\r\n+\r\n+// âœ… GET All Bookings\r\n+app.get(\"/api/bookings\", (req, res) => {\r\n+  const data = fs.existsSync(filePath) ? fs.readFileSync(filePath) : \"[]\";\r\n+  res.send(JSON.parse(data));\r\n+});\r\n+\r\n+// âœ… POST New Booking with Validation\r\n+app.post(\"/api/bookings\", (req, res) => {\r\n+  const existingData = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n+  const newBooking = req.body;\r\n+\r\n+  if (\r\n+    !newBooking.fullName ||\r\n+    !newBooking.email ||\r\n+    !newBooking.phone ||\r\n+    !newBooking.roomType ||\r\n+    !newBooking.checkInDate ||\r\n+    !newBooking.checkOutDate\r\n+  ) {\r\n+    return res\r\n+      .status(400)\r\n+      .send({ success: false, message: \"âš ï¸ Please fill all required fields.\" });\r\n+  }\r\n+\r\n+  const rooms = parseInt(newBooking.roomsRequired) || 1;\r\n+  const maxAllowedGuests = rooms * 3;\r\n+  const totalPersons = 1 + (newBooking.guests?.length || 0);\r\n+  if (totalPersons > maxAllowedGuests) {\r\n+    return res.status(400).send({\r\n+      success: false,\r\n+      message: `âš ï¸ Only ${maxAllowedGuests} persons allowed for ${rooms} room(s).`,\r\n     });\r\n+  }\r\n \r\n-    const data = await res.json();\r\n-    console.log(data);\r\n-  } catch (err) {\r\n-    console.error(\"Error checking availability\", err);\r\n+  const checkIn = new Date(`${newBooking.checkInDate}T${newBooking.checkInTime}`);\r\n+  const checkOut = new Date(`${newBooking.checkOutDate}T${newBooking.checkOutTime}`);\r\n+  const days = Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24));\r\n+\r\n+  let rate = 0;\r\n+  switch (newBooking.roomType) {\r\n+    case \"Single\":\r\n+      rate = 800;\r\n+      break;\r\n+    case \"Double\":\r\n+      rate = 1200;\r\n+      break;\r\n+    case \"Suite\":\r\n+      rate = 1800;\r\n+      break;\r\n   }\r\n-};\r\n+\r\n+  newBooking.amount = rate * days * rooms;\r\n+  newBooking.createdAt = new Date().toISOString();\r\n+\r\n+  existingData.push(newBooking);\r\n+  fs.writeFileSync(filePath, JSON.stringify(existingData, null, 2));\r\n+\r\n+  res.send({\r\n+    success: true,\r\n+    message: \"Booking saved successfully\",\r\n+    id: existingData.length - 1,\r\n+  });\r\n+});\r\n+\r\n+// âœ… Unified Room Availability API (RoomType + Dates)\r\n+app.post(\"/api/rooms/check-availability\", (req, res) => {\r\n+  const { roomType, checkInDate, checkOutDate } = req.body;\r\n+\r\n+  if (!roomType || !checkInDate || !checkOutDate) {\r\n+    return res.status(400).json({ success: false, message: \"âš ï¸ RoomType, Check-In and Check-Out required\" });\r\n+  }\r\n+\r\n+  // Total rooms available per type\r\n+  const totalRoomsPerType = { Single: 10, Double: 5, Suite: 3 };\r\n+\r\n+  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n+\r\n+  const checkIn = new Date(checkInDate);\r\n+  const checkOut = new Date(checkOutDate);\r\n+\r\n+  // Count booked rooms of this type overlapping with given date range\r\n+  const bookedRooms = bookings.reduce((sum, b) => {\r\n+    if (b.roomType !== roomType) return sum;\r\n+\r\n+    const existingCheckIn = new Date(b.checkInDate);\r\n+    const existingCheckOut = new Date(b.checkOutDate);\r\n+\r\n+    // âœ… overlap check\r\n+    if (checkIn < existingCheckOut && checkOut > existingCheckIn) {\r\n+      return sum + (parseInt(b.roomsRequired) || 1);\r\n+    }\r\n+    return sum;\r\n+  }, 0);\r\n+\r\n+  const availableRooms = (totalRoomsPerType[roomType] || 0) - bookedRooms;\r\n+\r\n+  res.json({\r\n+    success: true,\r\n+    availableRooms,\r\n+    message:\r\n+      availableRooms > 0\r\n+        ? `${availableRooms} ${roomType} room(s) available`\r\n+        : `âš ï¸ No ${roomType} rooms available in selected dates`,\r\n+  });\r\n+});\r\n+\r\n+// âœ… Booking Summary API\r\n+app.get(\"/api/bookings/summary\", (req, res) => {\r\n+  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n+  const today = new Date();\r\n+  const summary = { daily: {}, weekly: {}, monthly: {} };\r\n+\r\n+  bookings.forEach((b) => {\r\n+    const checkIn = new Date(b.checkInDate);\r\n+    const checkOut = new Date(b.checkOutDate);\r\n+    if (isNaN(checkIn) || isNaN(checkOut)) return;\r\n+\r\n+    if (checkOut < today) return;\r\n+\r\n+    const rooms = parseInt(b.roomsRequired) || 1;\r\n+\r\n+    for (let d = new Date(checkIn); d <= checkOut; d.setDate(d.getDate() + 1)) {\r\n+      const dayKey = d.toISOString().split(\"T\")[0];\r\n+\r\n+      summary.daily[dayKey] = (summary.daily[dayKey] || 0) + rooms;\r\n+\r\n+      const weekNum = Math.ceil(d.getDate() / 7);\r\n+      const weekKey = `${d.getFullYear()}-W${weekNum}`;\r\n+      summary.weekly[weekKey] = (summary.weekly[weekKey] || 0) + rooms;\r\n+\r\n+      const monthKey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}`;\r\n+      summary.monthly[monthKey] = (summary.monthly[monthKey] || 0) + rooms;\r\n+    }\r\n+  });\r\n+\r\n+  res.json(summary);\r\n+});\r\n+\r\n+// âœ… Admin Dashboard Stats API\r\n+app.get(\"/api/admin/dashboard\", (req, res) => {\r\n+  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n+  const today = new Date();\r\n+\r\n+  const activeBookings = bookings.filter(b => new Date(b.checkOutDate) >= today);\r\n+\r\n+  const totalBookings = bookings.length;\r\n+  const availableRooms = 20 - activeBookings.reduce((sum, b) => sum + (parseInt(b.roomsRequired) || 1), 0);\r\n+  const onlinePayments = bookings.filter(b => b.paymentStatus?.toLowerCase() === \"online\").length;\r\n+  const cashPayments = bookings.filter(b => b.paymentStatus?.toLowerCase() === \"cash\").length;\r\n+\r\n+  res.json({\r\n+    totalBookings,\r\n+    availableRooms: availableRooms < 0 ? 0 : availableRooms,\r\n+    onlinePayments,\r\n+    cashPayments\r\n+  });\r\n+});\r\n+\r\n+// âœ… Invoice API\r\n+app.get(\"/api/bookings/:id/invoice\", (req, res) => {\r\n+  const id = parseInt(req.params.id);\r\n+  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n+  const booking = bookings[id];\r\n+  if (!booking) return res.status(404).send({ error: \"Booking not found\" });\r\n+\r\n+  const doc = new PDFDocument({ margin: 50 });\r\n+  res.setHeader(\"Content-Type\", \"application/pdf\");\r\n+  res.setHeader(\"Content-Disposition\", `attachment; filename=invoice-${id}.pdf`);\r\n+  doc.pipe(res);\r\n+\r\n+  const logoPath = path.join(__dirname, \"university-logo.png\");\r\n+  doc.save().rect(20, 20, 572, 752).lineWidth(2).strokeColor(\"#003366\").stroke().restore();\r\n+  if (fs.existsSync(logoPath)) doc.opacity(0.08).image(logoPath, 180, 340, { width: 250 }).opacity(1);\r\n+  doc.save().rect(20, 20, 572, 90).fill(\"#003366\").restore();\r\n+  if (fs.existsSync(logoPath)) doc.image(logoPath, 40, 30, { width: 70 });\r\n+  doc.fillColor(\"white\").fontSize(24).text(\"Aryabhatta Knowledge University\", 130, 40);\r\n+  doc.fontSize(14).text(\"Guest House Booking Invoice\", 130, 65);\r\n+  doc.fillColor(\"#003366\").moveTo(40, 130).lineTo(560, 130).stroke();\r\n+\r\n+  const left = 40;\r\n+  const columnWidth = 200;\r\n+  let y = 150;\r\n+\r\n+  const details = [\r\n+    [\"Guest Name\", booking.fullName],\r\n+    [\"Address\", booking.address],\r\n+    [\"Email\", booking.email],\r\n+    [\"Phone\", booking.phone],\r\n+    [\"Purpose of Visit\", booking.purpose],\r\n+    [\"Room Type\", booking.roomType],\r\n+    [\"Rooms Required\", booking.roomsRequired],\r\n+    [\"Check-In\", `${booking.checkInDate} ${booking.checkInTime}`],\r\n+    [\"Check-Out\", `${booking.checkOutDate} ${booking.checkOutTime}`],\r\n+    [\"Category\", booking.category],\r\n+    [\"Payment Status\", booking.paymentStatus],\r\n+    [\"Amount Paid\", `INR ${booking.amount}`],\r\n+    [\"Booking Date\", new Date(booking.createdAt).toLocaleString() ],\r\n+  ];\r\n+\r\n+  details.forEach(([label, value], i) => {\r\n+    const bg = i % 2 === 0 ? \"#f0f4f8\" : \"#ffffff\";\r\n+    doc.save().rect(left, y - 2, 500, 25).fill(bg).restore();\r\n+    doc.fillColor(\"#003366\").font(\"Helvetica-Bold\").fontSize(12).text(label, left + 10, y + 5);\r\n+    doc.fillColor(\"black\").font(\"Helvetica\").text(value || \"-\", left + columnWidth + 20, y + 5);\r\n+    y += 25;\r\n+  });\r\n+\r\n+  if (booking.guests && booking.guests.length > 0) {\r\n+    y += 30;\r\n+    doc.fontSize(14).fillColor(\"#003366\").text(\"Additional Guests\", left, y);\r\n+    y += 20;\r\n+    doc.fontSize(11).fillColor(\"white\").save().rect(left, y - 2, 500, 20).fill(\"#003366\").restore();\r\n+    doc.fillColor(\"white\").font(\"Helvetica-Bold\")\r\n+      .text(\"Name\", left + 5, y + 3)\r\n+      .text(\"Email\", left + 120, y + 3)\r\n+      .text(\"Phone\", left + 260, y + 3)\r\n+      .text(\"Age\", left + 380, y + 3);\r\n+    y += 22;\r\n+\r\n+    booking.guests.forEach((g, i) => {\r\n+      const bg = i % 2 === 0 ? \"#f9f9f9\" : \"#ffffff\";\r\n+      doc.save().rect(left, y - 2, 500, 20).fill(bg).restore();\r\n+      doc.fillColor(\"black\").font(\"Helvetica\").fontSize(10)\r\n+        .text(g.name || \"\", left + 5, y + 3)\r\n+        .text(g.email || \"\", left + 120, y + 3)\r\n+        .text(g.phone || \"\", left + 260, y + 3)\r\n+        .text(g.age || \"\", left + 380, y + 3);\r\n+      y += 22;\r\n+    });\r\n+  }\r\n+\r\n+  const signY = y + 40;\r\n+  doc.fontSize(12).fillColor(\"black\").text(\"Authorized Signature:\", left, signY);\r\n+  doc.moveTo(left + 150, signY + 15).lineTo(left + 280, signY + 15).strokeColor(\"#333\").stroke();\r\n+\r\n+  doc.moveTo(40, signY + 60).lineTo(560, signY + 60).strokeColor(\"#999\").stroke();\r\n+  doc.fontSize(12).fillColor(\"#003366\").text(\"Thank you for booking with Aryabhatta Knowledge University!\", 40, signY + 70, { align: \"center\" });\r\n+  doc.fontSize(10).fillColor(\"black\").text(\"ðŸ“ Address: Aryabhatta Knowledge University, Patna, Bihar\", 40, signY + 90, { align: \"center\" });\r\n+  doc.text(\"â˜Žï¸ Contact: +91 9525594357   |   âœ‰ï¸ Email: info@aku.ac.in\", 40, signY + 105, { align: \"center\" });\r\n+\r\n+  doc.end();\r\n+});\r\n+\r\n+// âœ… Serve React frontend\r\n+const buildPath = path.join(__dirname, \"../guesthouse-frontend/build\");\r\n+app.use(express.static(buildPath));\r\n+app.get(/.*/, (req, res) => res.sendFile(path.join(buildPath, \"index.html\")));\r\n+\r\n+app.listen(PORT, () => console.log(`ðŸš€ Server running at http://localhost:${PORT}`));\r\n"
                },
                {
                    "date": 1757871198079,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,17 +11,19 @@\n app.use(express.json());\r\n \r\n const filePath = path.join(__dirname, \"booking.json\");\r\n \r\n-// âœ… GET All Bookings\r\n+// âœ… GET all bookings\r\n app.get(\"/api/bookings\", (req, res) => {\r\n   const data = fs.existsSync(filePath) ? fs.readFileSync(filePath) : \"[]\";\r\n   res.send(JSON.parse(data));\r\n });\r\n \r\n-// âœ… POST New Booking with Validation\r\n+// âœ… POST new booking\r\n app.post(\"/api/bookings\", (req, res) => {\r\n-  const existingData = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n+  const existingData = fs.existsSync(filePath)\r\n+    ? JSON.parse(fs.readFileSync(filePath))\r\n+    : [];\r\n   const newBooking = req.body;\r\n \r\n   if (\r\n     !newBooking.fullName ||\r\n@@ -45,10 +47,10 @@\n       message: `âš ï¸ Only ${maxAllowedGuests} persons allowed for ${rooms} room(s).`,\r\n     });\r\n   }\r\n \r\n-  const checkIn = new Date(`${newBooking.checkInDate}T${newBooking.checkInTime}`);\r\n-  const checkOut = new Date(`${newBooking.checkOutDate}T${newBooking.checkOutTime}`);\r\n+  const checkIn = new Date(`${newBooking.checkInDate}T${newBooking.checkInTime || \"12:00\"}`);\r\n+  const checkOut = new Date(`${newBooking.checkOutDate}T${newBooking.checkOutTime || \"12:00\"}`);\r\n   const days = Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24));\r\n \r\n   let rate = 0;\r\n   switch (newBooking.roomType) {\r\n@@ -75,32 +77,29 @@\n     id: existingData.length - 1,\r\n   });\r\n });\r\n \r\n-// âœ… Unified Room Availability API (RoomType + Dates)\r\n+// âœ… POST room availability check (room type + dates)\r\n app.post(\"/api/rooms/check-availability\", (req, res) => {\r\n   const { roomType, checkInDate, checkOutDate } = req.body;\r\n \r\n   if (!roomType || !checkInDate || !checkOutDate) {\r\n     return res.status(400).json({ success: false, message: \"âš ï¸ RoomType, Check-In and Check-Out required\" });\r\n   }\r\n \r\n-  // Total rooms available per type\r\n   const totalRoomsPerType = { Single: 10, Double: 5, Suite: 3 };\r\n-\r\n   const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n \r\n   const checkIn = new Date(checkInDate);\r\n   const checkOut = new Date(checkOutDate);\r\n \r\n-  // Count booked rooms of this type overlapping with given date range\r\n   const bookedRooms = bookings.reduce((sum, b) => {\r\n     if (b.roomType !== roomType) return sum;\r\n \r\n     const existingCheckIn = new Date(b.checkInDate);\r\n     const existingCheckOut = new Date(b.checkOutDate);\r\n \r\n-    // âœ… overlap check\r\n+    // overlap check\r\n     if (checkIn < existingCheckOut && checkOut > existingCheckIn) {\r\n       return sum + (parseInt(b.roomsRequired) || 1);\r\n     }\r\n     return sum;\r\n@@ -117,9 +116,9 @@\n         : `âš ï¸ No ${roomType} rooms available in selected dates`,\r\n   });\r\n });\r\n \r\n-// âœ… Booking Summary API\r\n+// âœ… Booking summary\r\n app.get(\"/api/bookings/summary\", (req, res) => {\r\n   const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n   const today = new Date();\r\n   const summary = { daily: {}, weekly: {}, monthly: {} };\r\n@@ -127,16 +126,13 @@\n   bookings.forEach((b) => {\r\n     const checkIn = new Date(b.checkInDate);\r\n     const checkOut = new Date(b.checkOutDate);\r\n     if (isNaN(checkIn) || isNaN(checkOut)) return;\r\n-\r\n     if (checkOut < today) return;\r\n \r\n     const rooms = parseInt(b.roomsRequired) || 1;\r\n-\r\n     for (let d = new Date(checkIn); d <= checkOut; d.setDate(d.getDate() + 1)) {\r\n       const dayKey = d.toISOString().split(\"T\")[0];\r\n-\r\n       summary.daily[dayKey] = (summary.daily[dayKey] || 0) + rooms;\r\n \r\n       const weekNum = Math.ceil(d.getDate() / 7);\r\n       const weekKey = `${d.getFullYear()}-W${weekNum}`;\r\n@@ -149,25 +145,25 @@\n \r\n   res.json(summary);\r\n });\r\n \r\n-// âœ… Admin Dashboard Stats API\r\n+// âœ… Admin dashboard stats\r\n app.get(\"/api/admin/dashboard\", (req, res) => {\r\n   const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n   const today = new Date();\r\n \r\n-  const activeBookings = bookings.filter(b => new Date(b.checkOutDate) >= today);\r\n+  const activeBookings = bookings.filter((b) => new Date(b.checkOutDate) >= today);\r\n \r\n   const totalBookings = bookings.length;\r\n   const availableRooms = 20 - activeBookings.reduce((sum, b) => sum + (parseInt(b.roomsRequired) || 1), 0);\r\n-  const onlinePayments = bookings.filter(b => b.paymentStatus?.toLowerCase() === \"online\").length;\r\n-  const cashPayments = bookings.filter(b => b.paymentStatus?.toLowerCase() === \"cash\").length;\r\n+  const onlinePayments = bookings.filter((b) => b.paymentStatus?.toLowerCase() === \"online\").length;\r\n+  const cashPayments = bookings.filter((b) => b.paymentStatus?.toLowerCase() === \"cash\").length;\r\n \r\n   res.json({\r\n     totalBookings,\r\n     availableRooms: availableRooms < 0 ? 0 : availableRooms,\r\n     onlinePayments,\r\n-    cashPayments\r\n+    cashPayments,\r\n   });\r\n });\r\n \r\n // âœ… Invoice API\r\n@@ -182,77 +178,22 @@\n   res.setHeader(\"Content-Disposition\", `attachment; filename=invoice-${id}.pdf`);\r\n   doc.pipe(res);\r\n \r\n   const logoPath = path.join(__dirname, \"university-logo.png\");\r\n-  doc.save().rect(20, 20, 572, 752).lineWidth(2).strokeColor(\"#003366\").stroke().restore();\r\n-  if (fs.existsSync(logoPath)) doc.opacity(0.08).image(logoPath, 180, 340, { width: 250 }).opacity(1);\r\n-  doc.save().rect(20, 20, 572, 90).fill(\"#003366\").restore();\r\n   if (fs.existsSync(logoPath)) doc.image(logoPath, 40, 30, { width: 70 });\r\n-  doc.fillColor(\"white\").fontSize(24).text(\"Aryabhatta Knowledge University\", 130, 40);\r\n+\r\n+  doc.fillColor(\"black\").fontSize(18).text(\"Aryabhatta Knowledge University\", 130, 40);\r\n   doc.fontSize(14).text(\"Guest House Booking Invoice\", 130, 65);\r\n-  doc.fillColor(\"#003366\").moveTo(40, 130).lineTo(560, 130).stroke();\r\n \r\n-  const left = 40;\r\n-  const columnWidth = 200;\r\n-  let y = 150;\r\n+  doc.fontSize(12).text(`Guest Name: ${booking.fullName}`);\r\n+  doc.text(`Email: ${booking.email}`);\r\n+  doc.text(`Phone: ${booking.phone}`);\r\n+  doc.text(`Room Type: ${booking.roomType}`);\r\n+  doc.text(`Rooms: ${booking.roomsRequired}`);\r\n+  doc.text(`Check-In: ${booking.checkInDate}`);\r\n+  doc.text(`Check-Out: ${booking.checkOutDate}`);\r\n+  doc.text(`Amount Paid: INR ${booking.amount}`);\r\n \r\n-  const details = [\r\n-    [\"Guest Name\", booking.fullName],\r\n-    [\"Address\", booking.address],\r\n-    [\"Email\", booking.email],\r\n-    [\"Phone\", booking.phone],\r\n-    [\"Purpose of Visit\", booking.purpose],\r\n-    [\"Room Type\", booking.roomType],\r\n-    [\"Rooms Required\", booking.roomsRequired],\r\n-    [\"Check-In\", `${booking.checkInDate} ${booking.checkInTime}`],\r\n-    [\"Check-Out\", `${booking.checkOutDate} ${booking.checkOutTime}`],\r\n-    [\"Category\", booking.category],\r\n-    [\"Payment Status\", booking.paymentStatus],\r\n-    [\"Amount Paid\", `INR ${booking.amount}`],\r\n-    [\"Booking Date\", new Date(booking.createdAt).toLocaleString() ],\r\n-  ];\r\n-\r\n-  details.forEach(([label, value], i) => {\r\n-    const bg = i % 2 === 0 ? \"#f0f4f8\" : \"#ffffff\";\r\n-    doc.save().rect(left, y - 2, 500, 25).fill(bg).restore();\r\n-    doc.fillColor(\"#003366\").font(\"Helvetica-Bold\").fontSize(12).text(label, left + 10, y + 5);\r\n-    doc.fillColor(\"black\").font(\"Helvetica\").text(value || \"-\", left + columnWidth + 20, y + 5);\r\n-    y += 25;\r\n-  });\r\n-\r\n-  if (booking.guests && booking.guests.length > 0) {\r\n-    y += 30;\r\n-    doc.fontSize(14).fillColor(\"#003366\").text(\"Additional Guests\", left, y);\r\n-    y += 20;\r\n-    doc.fontSize(11).fillColor(\"white\").save().rect(left, y - 2, 500, 20).fill(\"#003366\").restore();\r\n-    doc.fillColor(\"white\").font(\"Helvetica-Bold\")\r\n-      .text(\"Name\", left + 5, y + 3)\r\n-      .text(\"Email\", left + 120, y + 3)\r\n-      .text(\"Phone\", left + 260, y + 3)\r\n-      .text(\"Age\", left + 380, y + 3);\r\n-    y += 22;\r\n-\r\n-    booking.guests.forEach((g, i) => {\r\n-      const bg = i % 2 === 0 ? \"#f9f9f9\" : \"#ffffff\";\r\n-      doc.save().rect(left, y - 2, 500, 20).fill(bg).restore();\r\n-      doc.fillColor(\"black\").font(\"Helvetica\").fontSize(10)\r\n-        .text(g.name || \"\", left + 5, y + 3)\r\n-        .text(g.email || \"\", left + 120, y + 3)\r\n-        .text(g.phone || \"\", left + 260, y + 3)\r\n-        .text(g.age || \"\", left + 380, y + 3);\r\n-      y += 22;\r\n-    });\r\n-  }\r\n-\r\n-  const signY = y + 40;\r\n-  doc.fontSize(12).fillColor(\"black\").text(\"Authorized Signature:\", left, signY);\r\n-  doc.moveTo(left + 150, signY + 15).lineTo(left + 280, signY + 15).strokeColor(\"#333\").stroke();\r\n-\r\n-  doc.moveTo(40, signY + 60).lineTo(560, signY + 60).strokeColor(\"#999\").stroke();\r\n-  doc.fontSize(12).fillColor(\"#003366\").text(\"Thank you for booking with Aryabhatta Knowledge University!\", 40, signY + 70, { align: \"center\" });\r\n-  doc.fontSize(10).fillColor(\"black\").text(\"ðŸ“ Address: Aryabhatta Knowledge University, Patna, Bihar\", 40, signY + 90, { align: \"center\" });\r\n-  doc.text(\"â˜Žï¸ Contact: +91 9525594357   |   âœ‰ï¸ Email: info@aku.ac.in\", 40, signY + 105, { align: \"center\" });\r\n-\r\n   doc.end();\r\n });\r\n \r\n // âœ… Serve React frontend\r\n"
                },
                {
                    "date": 1757871447004,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,19 +11,38 @@\n app.use(express.json());\r\n \r\n const filePath = path.join(__dirname, \"booking.json\");\r\n \r\n-// âœ… GET all bookings\r\n+// âœ… Helper to read booking.json safely\r\n+function readBookings() {\r\n+  if (!fs.existsSync(filePath)) {\r\n+    fs.writeFileSync(filePath, \"[]\", \"utf8\");\r\n+    return [];\r\n+  }\r\n+  try {\r\n+    const data = fs.readFileSync(filePath, \"utf8\");\r\n+    return JSON.parse(data || \"[]\");\r\n+  } catch (err) {\r\n+    console.error(\"Error parsing booking.json, resetting file.\", err);\r\n+    fs.writeFileSync(filePath, \"[]\", \"utf8\");\r\n+    return [];\r\n+  }\r\n+}\r\n+\r\n+// âœ… Helper to write booking.json\r\n+function writeBookings(data) {\r\n+  fs.writeFileSync(filePath, JSON.stringify(data, null, 2), \"utf8\");\r\n+}\r\n+\r\n+// âœ… GET All Bookings\r\n app.get(\"/api/bookings\", (req, res) => {\r\n-  const data = fs.existsSync(filePath) ? fs.readFileSync(filePath) : \"[]\";\r\n-  res.send(JSON.parse(data));\r\n+  const bookings = readBookings();\r\n+  res.json(bookings);\r\n });\r\n \r\n-// âœ… POST new booking\r\n+// âœ… POST New Booking\r\n app.post(\"/api/bookings\", (req, res) => {\r\n-  const existingData = fs.existsSync(filePath)\r\n-    ? JSON.parse(fs.readFileSync(filePath))\r\n-    : [];\r\n+  const bookings = readBookings();\r\n   const newBooking = req.body;\r\n \r\n   if (\r\n     !newBooking.fullName ||\r\n@@ -32,26 +51,24 @@\n     !newBooking.roomType ||\r\n     !newBooking.checkInDate ||\r\n     !newBooking.checkOutDate\r\n   ) {\r\n-    return res\r\n-      .status(400)\r\n-      .send({ success: false, message: \"âš ï¸ Please fill all required fields.\" });\r\n+    return res.status(400).json({ success: false, message: \"âš ï¸ Please fill all required fields.\" });\r\n   }\r\n \r\n   const rooms = parseInt(newBooking.roomsRequired) || 1;\r\n   const maxAllowedGuests = rooms * 3;\r\n   const totalPersons = 1 + (newBooking.guests?.length || 0);\r\n   if (totalPersons > maxAllowedGuests) {\r\n-    return res.status(400).send({\r\n+    return res.status(400).json({\r\n       success: false,\r\n       message: `âš ï¸ Only ${maxAllowedGuests} persons allowed for ${rooms} room(s).`,\r\n     });\r\n   }\r\n \r\n-  const checkIn = new Date(`${newBooking.checkInDate}T${newBooking.checkInTime || \"12:00\"}`);\r\n-  const checkOut = new Date(`${newBooking.checkOutDate}T${newBooking.checkOutTime || \"12:00\"}`);\r\n-  const days = Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24));\r\n+  const checkIn = new Date(`${newBooking.checkInDate}T${newBooking.checkInTime || \"00:00\"}`);\r\n+  const checkOut = new Date(`${newBooking.checkOutDate}T${newBooking.checkOutTime || \"00:00\"}`);\r\n+  const days = Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24)) || 1;\r\n \r\n   let rate = 0;\r\n   switch (newBooking.roomType) {\r\n     case \"Single\":\r\n@@ -67,28 +84,23 @@\n \r\n   newBooking.amount = rate * days * rooms;\r\n   newBooking.createdAt = new Date().toISOString();\r\n \r\n-  existingData.push(newBooking);\r\n-  fs.writeFileSync(filePath, JSON.stringify(existingData, null, 2));\r\n+  bookings.push(newBooking);\r\n+  writeBookings(bookings);\r\n \r\n-  res.send({\r\n-    success: true,\r\n-    message: \"Booking saved successfully\",\r\n-    id: existingData.length - 1,\r\n-  });\r\n+  res.json({ success: true, message: \"Booking saved successfully\", id: bookings.length - 1 });\r\n });\r\n \r\n-// âœ… POST room availability check (room type + dates)\r\n+// âœ… Check Room Availability (POST)\r\n app.post(\"/api/rooms/check-availability\", (req, res) => {\r\n   const { roomType, checkInDate, checkOutDate } = req.body;\r\n-\r\n   if (!roomType || !checkInDate || !checkOutDate) {\r\n     return res.status(400).json({ success: false, message: \"âš ï¸ RoomType, Check-In and Check-Out required\" });\r\n   }\r\n \r\n   const totalRoomsPerType = { Single: 10, Double: 5, Suite: 3 };\r\n-  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n+  const bookings = readBookings();\r\n \r\n   const checkIn = new Date(checkInDate);\r\n   const checkOut = new Date(checkOutDate);\r\n \r\n@@ -116,18 +128,19 @@\n         : `âš ï¸ No ${roomType} rooms available in selected dates`,\r\n   });\r\n });\r\n \r\n-// âœ… Booking summary\r\n+// âœ… Booking Summary\r\n app.get(\"/api/bookings/summary\", (req, res) => {\r\n-  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n+  const bookings = readBookings();\r\n   const today = new Date();\r\n   const summary = { daily: {}, weekly: {}, monthly: {} };\r\n \r\n   bookings.forEach((b) => {\r\n     const checkIn = new Date(b.checkInDate);\r\n     const checkOut = new Date(b.checkOutDate);\r\n     if (isNaN(checkIn) || isNaN(checkOut)) return;\r\n+\r\n     if (checkOut < today) return;\r\n \r\n     const rooms = parseInt(b.roomsRequired) || 1;\r\n     for (let d = new Date(checkIn); d <= checkOut; d.setDate(d.getDate() + 1)) {\r\n@@ -145,32 +158,31 @@\n \r\n   res.json(summary);\r\n });\r\n \r\n-// âœ… Admin dashboard stats\r\n+// âœ… Admin Dashboard\r\n app.get(\"/api/admin/dashboard\", (req, res) => {\r\n-  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n+  const bookings = readBookings();\r\n   const today = new Date();\r\n \r\n-  const activeBookings = bookings.filter((b) => new Date(b.checkOutDate) >= today);\r\n-\r\n+  const activeBookings = bookings.filter(b => new Date(b.checkOutDate) >= today);\r\n   const totalBookings = bookings.length;\r\n   const availableRooms = 20 - activeBookings.reduce((sum, b) => sum + (parseInt(b.roomsRequired) || 1), 0);\r\n-  const onlinePayments = bookings.filter((b) => b.paymentStatus?.toLowerCase() === \"online\").length;\r\n-  const cashPayments = bookings.filter((b) => b.paymentStatus?.toLowerCase() === \"cash\").length;\r\n+  const onlinePayments = bookings.filter(b => b.paymentStatus?.toLowerCase() === \"online\").length;\r\n+  const cashPayments = bookings.filter(b => b.paymentStatus?.toLowerCase() === \"cash\").length;\r\n \r\n   res.json({\r\n     totalBookings,\r\n     availableRooms: availableRooms < 0 ? 0 : availableRooms,\r\n     onlinePayments,\r\n-    cashPayments,\r\n+    cashPayments\r\n   });\r\n });\r\n \r\n // âœ… Invoice API\r\n app.get(\"/api/bookings/:id/invoice\", (req, res) => {\r\n   const id = parseInt(req.params.id);\r\n-  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n+  const bookings = readBookings();\r\n   const booking = bookings[id];\r\n   if (!booking) return res.status(404).send({ error: \"Booking not found\" });\r\n \r\n   const doc = new PDFDocument({ margin: 50 });\r\n@@ -180,18 +192,18 @@\n \r\n   const logoPath = path.join(__dirname, \"university-logo.png\");\r\n   if (fs.existsSync(logoPath)) doc.image(logoPath, 40, 30, { width: 70 });\r\n \r\n-  doc.fillColor(\"black\").fontSize(18).text(\"Aryabhatta Knowledge University\", 130, 40);\r\n-  doc.fontSize(14).text(\"Guest House Booking Invoice\", 130, 65);\r\n+  doc.fontSize(20).text(\"Aryabhatta Knowledge University\", 130, 40);\r\n+  doc.fontSize(14).text(\"Guest House Booking Invoice\", 130, 70);\r\n \r\n-  doc.fontSize(12).text(`Guest Name: ${booking.fullName}`);\r\n+  doc.fontSize(12).text(`Guest Name: ${booking.fullName}`, 40, 130);\r\n   doc.text(`Email: ${booking.email}`);\r\n   doc.text(`Phone: ${booking.phone}`);\r\n   doc.text(`Room Type: ${booking.roomType}`);\r\n-  doc.text(`Rooms: ${booking.roomsRequired}`);\r\n-  doc.text(`Check-In: ${booking.checkInDate}`);\r\n-  doc.text(`Check-Out: ${booking.checkOutDate}`);\r\n+  doc.text(`Rooms Required: ${booking.roomsRequired}`);\r\n+  doc.text(`Check-In: ${booking.checkInDate} ${booking.checkInTime || \"\"}`);\r\n+  doc.text(`Check-Out: ${booking.checkOutDate} ${booking.checkOutTime || \"\"}`);\r\n   doc.text(`Amount Paid: INR ${booking.amount}`);\r\n \r\n   doc.end();\r\n });\r\n"
                },
                {
                    "date": 1758513426588,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,10 @@\n const cors = require(\"cors\");\r\n const fs = require(\"fs\");\r\n const path = require(\"path\");\r\n const PDFDocument = require(\"pdfkit\");\r\n+const { v4: uuidv4 } = require(\"uuid\"); // To generate unique temporary IDs\r\n+const nodemailer = require(\"nodemailer\"); // For sending emails\r\n \r\n const app = express();\r\n const PORT = 5000;\r\n \r\n@@ -32,66 +34,212 @@\n function writeBookings(data) {\r\n   fs.writeFileSync(filePath, JSON.stringify(data, null, 2), \"utf8\");\r\n }\r\n \r\n-// âœ… GET All Bookings\r\n+// ðŸ“§ Helper function to send email\r\n+async function sendEmail(to, subject, html, attachments = []) {\r\n+  const transporter = nodemailer.createTransport({\r\n+    service: \"gmail\", // Use your email service\r\n+    auth: {\r\n+      user: \"your-email@gmail.com\", // Your email\r\n+      pass: \"your-password\", // Your email password or app-specific password\r\n+    },\r\n+  });\r\n+\r\n+  const mailOptions = {\r\n+    from: \"your-email@gmail.com\",\r\n+    to,\r\n+    subject,\r\n+    html,\r\n+    attachments,\r\n+  };\r\n+\r\n+  try {\r\n+    await transporter.sendMail(mailOptions);\r\n+    console.log(\"Email sent successfully\");\r\n+  } catch (error) {\r\n+    console.error(\"Error sending email:\", error);\r\n+  }\r\n+}\r\n+\r\n+// ðŸ“„ Helper to generate PDF\r\n+function generateBookingPdf(booking, reason = null) {\r\n+  return new Promise((resolve, reject) => {\r\n+    const doc = new PDFDocument({ margin: 50 });\r\n+    const buffers = [];\r\n+    doc.on(\"data\", buffers.push.bind(buffers));\r\n+    doc.on(\"end\", () => {\r\n+      const pdfData = Buffer.concat(buffers);\r\n+      resolve(pdfData);\r\n+    });\r\n+\r\n+    const logoPath = path.join(__dirname, \"university-logo.png\");\r\n+    if (fs.existsSync(logoPath)) doc.image(logoPath, 40, 30, { width: 70 });\r\n+\r\n+    doc.fontSize(20).text(\"Aryabhatta Knowledge University\", 130, 40);\r\n+    doc.fontSize(14).text(\"Guest House Booking Details\", 130, 70);\r\n+    doc.moveDown(2);\r\n+\r\n+    if (reason) {\r\n+      doc.fontSize(16).fillColor('red').text(\"BOOKING DECLINED\", { align: 'center' });\r\n+      doc.moveDown(1);\r\n+      doc.fontSize(12).fillColor('black').text(`Reason for Decline: ${reason}`);\r\n+      doc.moveDown(1);\r\n+    } else {\r\n+      doc.fontSize(16).fillColor('green').text(\"BOOKING CONFIRMED\", { align: 'center' });\r\n+      doc.moveDown(1);\r\n+      doc.fontSize(12).fillColor('black').text(`Booking ID: ${booking.bookingId}`);\r\n+      doc.moveDown(1);\r\n+    }\r\n+    \r\n+    doc.fontSize(12).text(`Guest Name: ${booking.fullName}`);\r\n+    doc.text(`Email: ${booking.email}`);\r\n+    doc.text(`Phone: ${booking.phone}`);\r\n+    doc.text(`Room Type: ${booking.roomType}`);\r\n+    doc.text(`Rooms Required: ${booking.roomsRequired}`);\r\n+    doc.text(`Check-In: ${booking.checkInDate}`);\r\n+    doc.text(`Check-Out: ${booking.checkOutDate}`);\r\n+    doc.text(`Amount: â‚¹ ${booking.amount}`);\r\n+    if (booking.roomNumber) {\r\n+        doc.text(`Room Number: ${booking.roomNumber}`);\r\n+    }\r\n+\r\n+    doc.end();\r\n+  });\r\n+}\r\n+\r\n+// âœ… GET All Bookings (Updated to use status)\r\n app.get(\"/api/bookings\", (req, res) => {\r\n   const bookings = readBookings();\r\n   res.json(bookings);\r\n });\r\n \r\n-// âœ… POST New Booking\r\n+// âœ… GET Pending Bookings for Admin Dashboard\r\n+app.get(\"/api/bookings/pending\", (req, res) => {\r\n+  const bookings = readBookings();\r\n+  const pendingBookings = bookings.filter(b => b.status === \"pending\");\r\n+  res.json(pendingBookings);\r\n+});\r\n+\r\n+// âœ… POST New Booking (Updated with tempId and status)\r\n app.post(\"/api/bookings\", (req, res) => {\r\n   const bookings = readBookings();\r\n-  const newBooking = req.body;\r\n+  const newBooking = {\r\n+    ...req.body,\r\n+    tempId: uuidv4(),\r\n+    status: \"pending\",\r\n+    createdAt: new Date().toISOString(),\r\n+  };\r\n \r\n-  if (\r\n-    !newBooking.fullName ||\r\n-    !newBooking.email ||\r\n-    !newBooking.phone ||\r\n-    !newBooking.roomType ||\r\n-    !newBooking.checkInDate ||\r\n-    !newBooking.checkOutDate\r\n-  ) {\r\n-    return res.status(400).json({ success: false, message: \"âš ï¸ Please fill all required fields.\" });\r\n+  bookings.push(newBooking);\r\n+  writeBookings(bookings);\r\n+\r\n+  res.json({ success: true, message: \"Booking request received. Awaiting admin approval.\", tempId: newBooking.tempId });\r\n+});\r\n+\r\n+// âœ… POST Admin Approve Booking\r\n+app.post(\"/api/bookings/approve\", async (req, res) => {\r\n+  const { tempId, roomNumber } = req.body;\r\n+  if (!tempId || !roomNumber) {\r\n+    return res.status(400).json({ message: \"Temporary ID and room number required.\" });\r\n   }\r\n+  const bookings = readBookings();\r\n+  const bookingIndex = bookings.findIndex(b => b.tempId === tempId);\r\n \r\n-  const rooms = parseInt(newBooking.roomsRequired) || 1;\r\n-  const maxAllowedGuests = rooms * 3;\r\n-  const totalPersons = 1 + (newBooking.guests?.length || 0);\r\n-  if (totalPersons > maxAllowedGuests) {\r\n-    return res.status(400).json({\r\n-      success: false,\r\n-      message: `âš ï¸ Only ${maxAllowedGuests} persons allowed for ${rooms} room(s).`,\r\n-    });\r\n+  if (bookingIndex === -1) {\r\n+    return res.status(404).json({ message: \"Booking not found.\" });\r\n   }\r\n \r\n-  const checkIn = new Date(`${newBooking.checkInDate}T${newBooking.checkInTime || \"00:00\"}`);\r\n-  const checkOut = new Date(`${newBooking.checkOutDate}T${newBooking.checkOutTime || \"00:00\"}`);\r\n-  const days = Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24)) || 1;\r\n+  const booking = bookings[bookingIndex];\r\n+  booking.status = \"approved\";\r\n+  booking.bookingId = Math.random().toString(36).substring(2, 10).toUpperCase(); // Example permanent ID\r\n+  booking.roomNumber = roomNumber;\r\n+  writeBookings(bookings);\r\n \r\n-  let rate = 0;\r\n-  switch (newBooking.roomType) {\r\n-    case \"Single\":\r\n-      rate = 800;\r\n-      break;\r\n-    case \"Double\":\r\n-      rate = 1200;\r\n-      break;\r\n-    case \"Suite\":\r\n-      rate = 1800;\r\n-      break;\r\n+  try {\r\n+    const pdfBuffer = await generateBookingPdf(booking);\r\n+    await sendEmail(\r\n+      booking.email,\r\n+      \"Booking Confirmed - Aryabhatta Guest House\",\r\n+      `Dear ${booking.fullName},<br/><br/>Your booking has been approved. Your booking ID is <b>${booking.bookingId}</b> and your room number is <b>${booking.roomNumber}</b>. Please find the attached PDF with all the details.`,\r\n+      [{ filename: `booking-${booking.bookingId}.pdf`, content: pdfBuffer }]\r\n+    );\r\n+    res.json({ success: true, message: \"Booking approved and confirmation sent.\" });\r\n+  } catch (error) {\r\n+    console.error(\"Approval process failed:\", error);\r\n+    res.status(500).json({ message: \"Approval failed. Please check server logs.\" });\r\n   }\r\n+});\r\n \r\n-  newBooking.amount = rate * days * rooms;\r\n-  newBooking.createdAt = new Date().toISOString();\r\n+// âœ… POST Admin Decline Booking\r\n+app.post(\"/api/bookings/decline\", async (req, res) => {\r\n+  const { tempId, reason } = req.body;\r\n+  if (!tempId || !reason) {\r\n+    return res.status(400).json({ message: \"Temporary ID and reason required.\" });\r\n+  }\r\n+  const bookings = readBookings();\r\n+  const bookingIndex = bookings.findIndex(b => b.tempId === tempId);\r\n \r\n-  bookings.push(newBooking);\r\n+  if (bookingIndex === -1) {\r\n+    return res.status(404).json({ message: \"Booking not found.\" });\r\n+  }\r\n+\r\n+  const booking = bookings[bookingIndex];\r\n+  booking.status = \"declined\";\r\n+  booking.declineReason = reason;\r\n   writeBookings(bookings);\r\n \r\n-  res.json({ success: true, message: \"Booking saved successfully\", id: bookings.length - 1 });\r\n+  try {\r\n+    const pdfBuffer = await generateBookingPdf(booking, reason);\r\n+    await sendEmail(\r\n+      booking.email,\r\n+      \"Booking Declined - Aryabhatta Guest House\",\r\n+      `Dear ${booking.fullName},<br/><br/>We regret to inform you that your booking has been declined. Please find the attached PDF for more details.`,\r\n+      [{ filename: `decline-notice.pdf`, content: pdfBuffer }]\r\n+    );\r\n+    res.json({ success: true, message: \"Booking declined and notification sent.\" });\r\n+  } catch (error) {\r\n+    console.error(\"Decline process failed:\", error);\r\n+    res.status(500).json({ message: \"Decline failed. Please check server logs.\" });\r\n+  }\r\n });\r\n \r\n+\r\n+// Existing Invoice API\r\n+app.get(\"/api/bookings/:id/invoice\", (req, res) => {\r\n+  const id = parseInt(req.params.id);\r\n+  const bookings = readBookings();\r\n+  const booking = bookings[id];\r\n+  if (!booking) return res.status(404).send({ error: \"Booking not found\" });\r\n+\r\n+  const doc = new PDFDocument({ margin: 50 });\r\n+  res.setHeader(\"Content-Type\", \"application/pdf\");\r\n+  res.setHeader(\"Content-Disposition\", `attachment; filename=invoice-${id}.pdf`);\r\n+  doc.pipe(res);\r\n+\r\n+  const logoPath = path.join(__dirname, \"university-logo.png\");\r\n+  if (fs.existsSync(logoPath)) doc.image(logoPath, 40, 30, { width: 70 });\r\n+\r\n+  doc.fontSize(20).text(\"Aryabhatta Knowledge University\", 130, 40);\r\n+  doc.fontSize(14).text(\"Guest House Booking Invoice\", 130, 70);\r\n+\r\n+  doc.fontSize(12).text(`Guest Name: ${booking.fullName}`, 40, 130);\r\n+  doc.text(`Email: ${booking.email}`);\r\n+  doc.text(`Phone: ${booking.phone}`);\r\n+  doc.text(`Room Type: ${booking.roomType}`);\r\n+  doc.text(`Rooms Required: ${booking.roomsRequired}`);\r\n+  doc.text(`Check-In: ${booking.checkInDate} ${booking.checkInTime || \"\"}`);\r\n+  doc.text(`Check-Out: ${booking.checkOutDate} ${booking.checkOutTime || \"\"}`);\r\n+  doc.text(`Amount Paid: INR ${booking.amount}`);\r\n+  doc.text(`Booking Status: ${booking.status}`);\r\n+  if (booking.bookingId) doc.text(`Booking ID: ${booking.bookingId}`);\r\n+  if (booking.roomNumber) doc.text(`Room Number: ${booking.roomNumber}`);\r\n+  if (booking.declineReason) doc.text(`Decline Reason: ${booking.declineReason}`);\r\n+\r\n+  doc.end();\r\n+});\r\n+\r\n+\r\n // âœ… Check Room Availability (POST)\r\n app.post(\"/api/rooms/check-availability\", (req, res) => {\r\n   const { roomType, checkInDate, checkOutDate } = req.body;\r\n   if (!roomType || !checkInDate || !checkOutDate) {\r\n@@ -104,9 +252,10 @@\n   const checkIn = new Date(checkInDate);\r\n   const checkOut = new Date(checkOutDate);\r\n \r\n   const bookedRooms = bookings.reduce((sum, b) => {\r\n-    if (b.roomType !== roomType) return sum;\r\n+    // Only count approved bookings that overlap\r\n+    if (b.status !== \"approved\" || b.roomType !== roomType) return sum;\r\n \r\n     const existingCheckIn = new Date(b.checkInDate);\r\n     const existingCheckOut = new Date(b.checkOutDate);\r\n \r\n@@ -135,8 +284,10 @@\n   const today = new Date();\r\n   const summary = { daily: {}, weekly: {}, monthly: {} };\r\n \r\n   bookings.forEach((b) => {\r\n+    // Only count approved bookings\r\n+    if (b.status !== \"approved\") return;\r\n     const checkIn = new Date(b.checkInDate);\r\n     const checkOut = new Date(b.checkOutDate);\r\n     if (isNaN(checkIn) || isNaN(checkOut)) return;\r\n \r\n@@ -163,54 +314,28 @@\n app.get(\"/api/admin/dashboard\", (req, res) => {\r\n   const bookings = readBookings();\r\n   const today = new Date();\r\n \r\n-  const activeBookings = bookings.filter(b => new Date(b.checkOutDate) >= today);\r\n+  const activeBookings = bookings.filter(b => b.status === \"approved\" && new Date(b.checkOutDate) >= today);\r\n+  const pendingBookings = bookings.filter(b => b.status === \"pending\").length;\r\n+  const declinedBookings = bookings.filter(b => b.status === \"declined\").length;\r\n   const totalBookings = bookings.length;\r\n   const availableRooms = 20 - activeBookings.reduce((sum, b) => sum + (parseInt(b.roomsRequired) || 1), 0);\r\n   const onlinePayments = bookings.filter(b => b.paymentStatus?.toLowerCase() === \"online\").length;\r\n   const cashPayments = bookings.filter(b => b.paymentStatus?.toLowerCase() === \"cash\").length;\r\n \r\n   res.json({\r\n     totalBookings,\r\n+    pendingBookings,\r\n+    declinedBookings,\r\n     availableRooms: availableRooms < 0 ? 0 : availableRooms,\r\n     onlinePayments,\r\n     cashPayments\r\n   });\r\n });\r\n \r\n-// âœ… Invoice API\r\n-app.get(\"/api/bookings/:id/invoice\", (req, res) => {\r\n-  const id = parseInt(req.params.id);\r\n-  const bookings = readBookings();\r\n-  const booking = bookings[id];\r\n-  if (!booking) return res.status(404).send({ error: \"Booking not found\" });\r\n-\r\n-  const doc = new PDFDocument({ margin: 50 });\r\n-  res.setHeader(\"Content-Type\", \"application/pdf\");\r\n-  res.setHeader(\"Content-Disposition\", `attachment; filename=invoice-${id}.pdf`);\r\n-  doc.pipe(res);\r\n-\r\n-  const logoPath = path.join(__dirname, \"university-logo.png\");\r\n-  if (fs.existsSync(logoPath)) doc.image(logoPath, 40, 30, { width: 70 });\r\n-\r\n-  doc.fontSize(20).text(\"Aryabhatta Knowledge University\", 130, 40);\r\n-  doc.fontSize(14).text(\"Guest House Booking Invoice\", 130, 70);\r\n-\r\n-  doc.fontSize(12).text(`Guest Name: ${booking.fullName}`, 40, 130);\r\n-  doc.text(`Email: ${booking.email}`);\r\n-  doc.text(`Phone: ${booking.phone}`);\r\n-  doc.text(`Room Type: ${booking.roomType}`);\r\n-  doc.text(`Rooms Required: ${booking.roomsRequired}`);\r\n-  doc.text(`Check-In: ${booking.checkInDate} ${booking.checkInTime || \"\"}`);\r\n-  doc.text(`Check-Out: ${booking.checkOutDate} ${booking.checkOutTime || \"\"}`);\r\n-  doc.text(`Amount Paid: INR ${booking.amount}`);\r\n-\r\n-  doc.end();\r\n-});\r\n-\r\n // âœ… Serve React frontend\r\n const buildPath = path.join(__dirname, \"../guesthouse-frontend/build\");\r\n app.use(express.static(buildPath));\r\n app.get(/.*/, (req, res) => res.sendFile(path.join(buildPath, \"index.html\")));\r\n \r\n-app.listen(PORT, () => console.log(`ðŸš€ Server running at http://localhost:${PORT}`));\r\n+app.listen(PORT, () => console.log(`ðŸš€ Server running at http://localhost:${PORT}`));\n\\ No newline at end of file\n"
                }
            ],
            "date": 1757140190170,
            "name": "Commit-0",
            "content": "// âœ… Full server.js with check-in/out date & time and additional guest info in PDF\r\n\r\nconst express = require(\"express\");\r\nconst cors = require(\"cors\");\r\nconst fs = require(\"fs\");\r\nconst path = require(\"path\");\r\nconst PDFDocument = require(\"pdfkit\");\r\n\r\nconst app = express();\r\nconst PORT = 5000;\r\n\r\napp.use(cors());\r\napp.use(express.json());\r\n\r\nconst filePath = path.join(__dirname, \"booking.json\");\r\n\r\n// âœ… GET All Bookings\r\napp.get(\"/api/bookings\", (req, res) => {\r\n  const data = fs.existsSync(filePath) ? fs.readFileSync(filePath) : \"[]\";\r\n  res.send(JSON.parse(data));\r\n});\r\n\r\n// âœ… POST New Booking with Validation\r\napp.post(\"/api/bookings\", (req, res) => {\r\n  const existingData = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n  const newBooking = req.body;\r\n\r\n  if (\r\n    !newBooking.fullName ||\r\n    !newBooking.email ||\r\n    !newBooking.phone ||\r\n    !newBooking.roomType ||\r\n    !newBooking.checkInDate ||\r\n    !newBooking.checkOutDate\r\n  ) {\r\n    return res\r\n      .status(400)\r\n      .send({ success: false, message: \"âš ï¸ Please fill all required fields.\" });\r\n  }\r\n\r\n  const rooms = parseInt(newBooking.roomsRequired) || 1;\r\n  const maxAllowedGuests = rooms * 3;\r\n  const totalPersons = 1 + (newBooking.guests?.length || 0);\r\n  if (totalPersons > maxAllowedGuests) {\r\n    return res.status(400).send({\r\n      success: false,\r\n      message: `âš ï¸ Only ${maxAllowedGuests} persons allowed for ${rooms} room(s).`,\r\n    });\r\n  }\r\n\r\n  const checkIn = new Date(`${newBooking.checkInDate}T${newBooking.checkInTime}`);\r\n  const checkOut = new Date(`${newBooking.checkOutDate}T${newBooking.checkOutTime}`);\r\n  const days = Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24));\r\n\r\n  let rate = 0;\r\n  switch (newBooking.roomType) {\r\n    case \"Single\":\r\n      rate = 800;\r\n      break;\r\n    case \"Double\":\r\n      rate = 1200;\r\n      break;\r\n    case \"Suite\":\r\n      rate = 1800;\r\n      break;\r\n  }\r\n\r\n  newBooking.amount = rate * days * rooms;\r\n  newBooking.createdAt = new Date().toISOString();\r\n\r\n  existingData.push(newBooking);\r\n  fs.writeFileSync(filePath, JSON.stringify(existingData, null, 2));\r\n\r\n  res.send({\r\n    success: true,\r\n    message: \"Booking saved successfully\",\r\n    id: existingData.length - 1,\r\n  });\r\n});\r\n\r\n// âœ… Booking Summary API (Daily / Weekly / Monthly)\r\napp.get(\"/api/bookings/summary\", (req, res) => {\r\n  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n\r\n  const summary = { daily: {}, weekly: {}, monthly: {} };\r\n\r\n  bookings.forEach((b) => {\r\n    const checkIn = new Date(b.checkIn || b.checkInDate);\r\n    const checkOut = new Date(b.checkOut || b.checkOutDate);\r\n    if (isNaN(checkIn) || isNaN(checkOut)) return;\r\n\r\n    const rooms = parseInt(b.roomsRequired) || 1;\r\n\r\n    for (let d = new Date(checkIn); d <= checkOut; d.setDate(d.getDate() + 1)) {\r\n      const dayKey = d.toISOString().split(\"T\")[0];\r\n\r\n      // Daily\r\n      summary.daily[dayKey] = (summary.daily[dayKey] || 0) + rooms;\r\n\r\n      // Weekly\r\n      const weekNum = Math.ceil(d.getDate() / 7);\r\n      const weekKey = `${d.getFullYear()}-W${weekNum}`;\r\n      summary.weekly[weekKey] = (summary.weekly[weekKey] || 0) + rooms;\r\n\r\n      // Monthly\r\n      const monthKey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}`;\r\n      summary.monthly[monthKey] = (summary.monthly[monthKey] || 0) + rooms;\r\n    }\r\n  });\r\n\r\n  res.json(summary);\r\n});\r\n\r\n// âœ… Invoice API\r\napp.get(\"/api/bookings/:id/invoice\", (req, res) => {\r\n  const id = parseInt(req.params.id);\r\n  const bookings = fs.existsSync(filePath) ? JSON.parse(fs.readFileSync(filePath)) : [];\r\n  const booking = bookings[id];\r\n  if (!booking) return res.status(404).send({ error: \"Booking not found\" });\r\n\r\n  const doc = new PDFDocument({ margin: 50 });\r\n  res.setHeader(\"Content-Type\", \"application/pdf\");\r\n  res.setHeader(\"Content-Disposition\", `attachment; filename=invoice-${id}.pdf`);\r\n  doc.pipe(res);\r\n\r\n  const logoPath = path.join(__dirname, \"university-logo.png\");\r\n  doc.save().rect(20, 20, 572, 752).lineWidth(2).strokeColor(\"#003366\").stroke().restore();\r\n  if (fs.existsSync(logoPath)) doc.opacity(0.08).image(logoPath, 180, 340, { width: 250 }).opacity(1);\r\n  doc.save().rect(20, 20, 572, 90).fill(\"#003366\").restore();\r\n  if (fs.existsSync(logoPath)) doc.image(logoPath, 40, 30, { width: 70 });\r\n  doc.fillColor(\"white\").fontSize(24).text(\"Aryabhatta Knowledge University\", 130, 40);\r\n  doc.fontSize(14).text(\"Guest House Booking Invoice\", 130, 65);\r\n  doc.fillColor(\"#003366\").moveTo(40, 130).lineTo(560, 130).stroke();\r\n\r\n  const left = 40;\r\n  const columnWidth = 200;\r\n  let y = 150;\r\n\r\n  const details = [\r\n    [\"Guest Name\", booking.fullName],\r\n    [\"Address\", booking.address],\r\n    [\"Email\", booking.email],\r\n    [\"Phone\", booking.phone],\r\n    [\"Purpose of Visit\", booking.purpose],\r\n    [\"Room Type\", booking.roomType],\r\n    [\"Rooms Required\", booking.roomsRequired],\r\n    [\"Check-In\", `${booking.checkInDate} ${booking.checkInTime}`],\r\n    [\"Check-Out\", `${booking.checkOutDate} ${booking.checkOutTime}`],\r\n    [\"Category\", booking.category],\r\n    [\"Payment Status\", booking.paymentStatus],\r\n    [\"Amount Paid\", `INR ${booking.amount}`],\r\n    [\"Booking Date\", new Date(booking.createdAt).toLocaleString()],\r\n  ];\r\n\r\n  details.forEach(([label, value], i) => {\r\n    const bg = i % 2 === 0 ? \"#f0f4f8\" : \"#ffffff\";\r\n    doc.save().rect(left, y - 2, 500, 25).fill(bg).restore();\r\n    doc.fillColor(\"#003366\").font(\"Helvetica-Bold\").fontSize(12).text(label, left + 10, y + 5);\r\n    doc.fillColor(\"black\").font(\"Helvetica\").text(value || \"-\", left + columnWidth + 20, y + 5);\r\n    y += 25;\r\n  });\r\n\r\n  if (booking.guests && booking.guests.length > 0) {\r\n    y += 30;\r\n    doc.fontSize(14).fillColor(\"#003366\").text(\"Additional Guests\", left, y);\r\n    y += 20;\r\n    doc.fontSize(11).fillColor(\"white\").save().rect(left, y - 2, 500, 20).fill(\"#003366\").restore();\r\n    doc.fillColor(\"white\").font(\"Helvetica-Bold\")\r\n      .text(\"Name\", left + 5, y + 3)\r\n      .text(\"Email\", left + 120, y + 3)\r\n      .text(\"Phone\", left + 260, y + 3)\r\n      .text(\"Age\", left + 380, y + 3);\r\n    y += 22;\r\n\r\n    booking.guests.forEach((g, i) => {\r\n      const bg = i % 2 === 0 ? \"#f9f9f9\" : \"#ffffff\";\r\n      doc.save().rect(left, y - 2, 500, 20).fill(bg).restore();\r\n      doc.fillColor(\"black\").font(\"Helvetica\").fontSize(10)\r\n        .text(g.name || \"\", left + 5, y + 3)\r\n        .text(g.email || \"\", left + 120, y + 3)\r\n        .text(g.phone || \"\", left + 260, y + 3)\r\n        .text(g.age || \"\", left + 380, y + 3);\r\n      y += 22;\r\n    });\r\n  }\r\n\r\n  const signY = y + 40;\r\n  doc.fontSize(12).fillColor(\"black\").text(\"Authorized Signature:\", left, signY);\r\n  doc.moveTo(left + 150, signY + 15).lineTo(left + 280, signY + 15).strokeColor(\"#333\").stroke();\r\n\r\n  doc.moveTo(40, signY + 60).lineTo(560, signY + 60).strokeColor(\"#999\").stroke();\r\n  doc.fontSize(12).fillColor(\"#003366\").text(\"Thank you for booking with Aryabhatta Knowledge University!\", 40, signY + 70, { align: \"center\" });\r\n  doc.fontSize(10).fillColor(\"black\").text(\"ðŸ“ Address: Aryabhatta Knowledge University, Patna, Bihar\", 40, signY + 90, { align: \"center\" });\r\n  doc.text(\"â˜Žï¸ Contact: +91 9525594357   |   âœ‰ï¸ Email: info@aku.ac.in\", 40, signY + 105, { align: \"center\" });\r\n\r\n  doc.end();\r\n});\r\n\r\nconst buildPath = path.join(__dirname, \"../guesthouse-frontend/build\");\r\napp.use(express.static(buildPath));\r\napp.get(/.*/, (req, res) => res.sendFile(path.join(buildPath, \"index.html\")));\r\n\r\napp.listen(PORT, () => console.log(`ðŸš€ Server running at http://localhost:${PORT}`));\r\n"
        }
    ]
}